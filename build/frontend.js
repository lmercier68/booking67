!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.ReactDOM,o=e.n(n),a=window.wp.element,r=function({practitionerId:e,onPrestationChange:n}){const[o,r]=(0,a.useState)([]);return(0,a.useEffect)((()=>{let t="/wp-json/booker67/v1/prestations";e&&(t+=`/practitioner_id/${e}`),fetch(t).then((e=>e.json())).then((e=>{r(e)})).catch((e=>{console.error("Erreur lors de la récupération des prestations:",e)}))}),[e]),console.log("prestations for practician: ",o),(0,t.createElement)("select",{onChange:e=>{n(e.target.value)}},(0,t.createElement)("option",{value:""},"Sélectionnez une prestation"),o.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.prestation_name," - ",e.prestation_cost," - ",e.prestation_duration))))},s=function({onPractitionerChange:e}){const[n,o]=(0,t.useState)([]);return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{o(e)}))}),[]),(0,t.createElement)("div",null,(0,t.createElement)("select",{id:"humanRessourceSelect",onChange:t=>{e(t.target.value)}},(0,t.createElement)("option",{value:""},"Choisir un praticien"),n.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},l=function({start:e,duration:n,onClick:o}){return(0,t.createElement)("div",{onClick:()=>{console.log(`Plage horaire de ${e} pour une durée de ${n} minutes cliquée.`),o()},style:{cursor:"pointer",padding:"5px",border:"1px solid #ccc"}},e)},i=function({day:e,startTime:n,endTime:o,durationTime:a}){const r=60*parseInt(n.split(":")[0])+parseInt(n.split(":")[1]),s=60*parseInt(o.split(":")[0])+parseInt(o.split(":")[1]),i=[];for(let n=r;n<s;n+=a){const o=n%60,r=`${Math.floor(n/60).toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;i.push((0,t.createElement)(l,{key:r,start:r,duration:a,onClick:()=>console.log(`${e} - ${r}`)}))}return(0,t.createElement)("div",{style:{margin:"5px"}},(0,t.createElement)("h3",null,e),i)},c=function({isCurrentWeek:e}){const[n,o]=(0,t.useState)("08:00"),[a,r]=(0,t.useState)("17:00"),[s,l]=(0,t.useState)(60),c=(new Date).getDay(),u=["Lundi","Mardi","Mercredi","Jeudi","Vendredi"],d=e?u.filter(((e,t)=>0===c||t+1>=c)):u;return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/options/generic_type/genType_startTime").then((e=>e.json())).then((e=>{e.length>0&&o(e[0].value)})),fetch("/wp-json/booker67/v1/options/generic_type/genType_endTime").then((e=>e.json())).then((e=>{e.length>0&&r(e[0].value)})),fetch("/wp-json/booker67/v1/options/generic_type/genType_durationTime").then((e=>e.json())).then((e=>{e.length>0&&l(parseInt(e[0].value))}))}),[]),(0,t.createElement)("div",{style:{display:"flex"}},d.map((e=>(0,t.createElement)(i,{key:e,day:e,startTime:n,endTime:a,durationTime:s}))))};function u(){const e=new Date,t=new Date(e.getFullYear(),0,1),n=Math.floor((e-t)/864e5+1);return Math.ceil(n/7)}var d=function(){const[e,n]=(0,t.useState)(u()),[o,a]=(0,t.useState)(!1),[r,s]=(0,t.useState)([]);return(0,t.useEffect)((()=>{const e=function(){const e=u(),t=function(e){const t=new Date(e,11,31);return Math.ceil(((t-new Date(e,0,1))/864e5+1)/7)}((new Date).getFullYear()),n=[];for(let o=e;o<=t;o++)n.push(o);return n}();s(e)}),[]),(0,t.createElement)("div",null,(0,t.createElement)("label",{htmlFor:"week-selector"},"Choisissez une semaine :"),(0,t.createElement)("select",{id:"week-selector",value:e,onChange:e=>{n(e.target.value),0===e.target.options.selectedIndex?a(!0):a(!1)}},r.map((e=>(0,t.createElement)("option",{key:e,value:e},"Semaine ",e)))),(0,t.createElement)(c,{selectedWeek:e,isCurrentWeek:o}))},p=({selectedPractitionerId:e,selectedWeek:n})=>{const[o,a]=(0,t.useState)(["e","r"]),[r,s]=(0,t.useState)([]);(0,t.useEffect)((()=>{0!==e&&fetch(`/wp-json/booker67/v1/appointments/${e}`).then((e=>e.json())).then((e=>{console.log("appoitements: ",e),s(e)})).catch((e=>{console.error("Erreur lors de la récupération des rendez-vous:",e)}))}),[e]),(0,t.useEffect)((()=>{0!==e&&fetch(`/wp-json/booker67/v1/availability/${e}`).then((e=>e.json())).then((e=>{const t=new Date(n.startDate),o=new Date(n.endDate),s=i(t),u=l(e,r,s),d=c(u,t,o,s);a(d)})).catch((e=>{console.error("Erreur lors de la récupération des disponibilités:",e)}))}),[e,r,n]);const l=(e,t,n)=>{let o=[],a=new Map;return e.forEach((e=>{let t=e.day_name.charAt(0).toUpperCase()+e.day_name.slice(1),o=n.get(t);if(o){let n=new Date(o);n.setHours(e.opening_time.split(":")[0],e.opening_time.split(":")[1],0);let r=new Date(o);r.setHours(e.closing_time.split(":")[0],e.closing_time.split(":")[1],0);let s=[];for(;n<r;)s.push(new Date(n)),n.setMinutes(n.getMinutes()+30);a.set(t,s)}})),console.log("Disponibilités :",e),console.log("Disponibilités map:",a),t.forEach((e=>{let t=new Date(e.rdv_dateTime),o=parseInt(e.prestation_duration.split(":")[0]),r=parseInt(e.prestation_duration.split(":")[1]||"0"),s=new Date(t);s.setHours(s.getHours()+o),s.setMinutes(s.getMinutes()+r);let l=t.toLocaleDateString("fr-FR",{weekday:"long"});l=l.charAt(0).toUpperCase()+l.slice(1),console.log("Clés dans availabilityMap:",[...a.keys()]),console.log("Clé recherchée:",l);let i=a.get(l);console.log("test1: ",t.toLocaleDateString("fr-FR",{weekday:"long"})),console.log("test2: ",n),console.log("test3: ",i),console.log("test31: ",t),console.log("test32: ",s),i&&(console.log("test4: ",i),a.set(l,i.filter((e=>e<t||e>=s))))})),console.log(a),a.forEach(((e,t)=>{e.forEach((e=>{let n=e.toLocaleDateString("fr-FR");o.push({day:t,date:n,time:e.toLocaleTimeString("fr-FR")})}))})),console.log("freeSlots : ",o),o},i=e=>{let t=new Map;const n=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];for(;1!==e.getDay();)e.setDate(e.getDate()-1);for(let o=0;o<7;o++){let a=new Date(e);a.setDate(e.getDate()+o);let r=a.toLocaleDateString("fr-FR",{weekday:"long"});console.log("day:",n[o]),r=r.charAt(0).toUpperCase()+r.slice(1),console.log("dayName: ",r),t.set(r,a)}return t},c=(e,t,n,o)=>(console.log("slots filterslotsweek",e),console.log("startDate filterslotsweek",t),console.log("endDate filterslotsweek",n),e.filter((e=>{const a=o.get(e.day);return a&&a>=t&&a<=n}))),u=new Date(n.startDate),d=new Date(n.endDate),p=i(u),g=c(o,u,d,p);return console.log("slots slotsForWeek",g),(0,t.createElement)("div",null,g.length>0?g.map(((e,n)=>(0,t.createElement)("div",{key:n},e.day," -  ",e.date," - ",e.time))):(0,t.createElement)("p",null,"Aucun créneau disponible pour cette semaine."))},g=({onWeekChange:e})=>{const n=(new Date).toISOString().split("T")[0],[o,a]=(0,t.useState)(n);return(0,t.createElement)("input",{type:"date",value:o,onChange:t=>{a(t.target.value);let n=(e=>{const t=new Date(e);t.setDate(t.getDate()-t.getDay()+1);const n=new Date(t);return n.setDate(n.getDate()+6),{startDate:t,endDate:n}})(new Date(t.target.value));e(n),console.log(n)}})};const m=()=>{const[e,n]=(0,t.useState)(0),[o,a]=(0,t.useState)(0),[l,i]=(0,t.useState)([]),[c,u]=(0,t.useState)({startDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+1),t.toISOString().split("T")[0]})(),endDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+7),t.toISOString().split("T")[0]})()});return(0,t.createElement)("div",null,(0,t.createElement)(s,{onPractitionerChange:e=>{n(e)}}),(0,t.createElement)(r,{practitionerId:e,onPrestationChange:e=>{a(e)}}),(0,t.createElement)(g,{onWeekChange:e=>{u(e)}}),(0,t.createElement)(p,{selectedPractitionerId:e,selectedWeek:c}),(0,t.createElement)(d,null))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("booking67-root");e&&o().render((0,t.createElement)(m,null),e)}))}();