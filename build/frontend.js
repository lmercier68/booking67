!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.ReactDOM,a=e.n(n),o=window.wp.element,r=function({practitionerId:e,onPrestationChange:n}){const[a,r]=(0,o.useState)([]);return(0,o.useEffect)((()=>{(async()=>{if(0!==e&&void 0!==e){let t="/wp-json/booker67/v1/prestations";e&&(t+=`/practitioner_id/${e}`),console.log('recuperation des prestation pour l"id: ',e);try{const e=await fetch(t),n=await e.json();console.log("prestation recupérée : ",n),r(n)}catch(e){console.error("Erreur lors de la récupération des prestations:",e)}}})()}),[e]),console.log("prestations for practician: ",a),(0,t.createElement)("div",null,(0,t.createElement)("label",{htmlFor:"prestationSelector",style:{fontWeight:"bold",display:"block",marginBottom:"5px"}},"Choix de la prestation :"),(0,t.createElement)("select",{id:"prestationSelector",onChange:e=>{n(e.target.value)}},(0,t.createElement)("option",{value:""},"Sélectionnez une prestation"),a.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.prestation_name," - ",e.prestation_cost," - ",e.prestation_duration)))))},s=function({onPractitionerChange:e}){const[n,a]=(0,t.useState)([]);return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{a(e)})).catch((e=>{console.error(e)}))}),[]),(0,t.createElement)("div",{style:{fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"10px"}},(0,t.createElement)("label",{htmlFor:"humanRessourceSelect",style:{display:"block",marginBottom:"5px"}},"Choix de l'intervenant :"),(0,t.createElement)("select",{id:"humanRessourceSelect",onChange:t=>{e(t.target.value)}},n.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},i=function({setObservation:e}){const[n,a]=(0,t.useState)("");return(0,t.createElement)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},(0,t.createElement)("label",{htmlFor:"appointmentObservation",style:{fontWeight:"bold",marginBottom:"5px"}},"Observation:"),(0,t.createElement)("div",{style:{width:"100%",display:"flex",justifyContent:"center"}},(0,t.createElement)("textarea",{id:"appointmentObservation",value:n,onChange:t=>{a(t.target.value),e(t.target.value)},placeholder:"Entrez votre observation ici...",style:{width:"70%",display:"block"}})))},l=({dateTimeSlot:e,practician:n,prestation:a,setNewAppointment:o,canWriteobservation:r,setObservation:s,userData:l,setUserData:c,onClose:u})=>{const[d,p]=(0,t.useState)(!1),[m,f]=(0,t.useState)(!0);(0,t.useEffect)((()=>{f(!0),fetch("/wp-json/booking67/v1/current-user",{method:"GET",headers:{"X-WP-Nonce":wpApiSettings.nonce}}).then((e=>e.json())).then((e=>{e.ID?(c({...l,user_mail:e.user_email,user_id:e.ID,user_name:e.user_login,user_firstName:e.user_firstname,user_lastName:e.user_lastname}),p(!0)):p(!1),f(!1)})).catch((e=>{console.error("Erreur lors du chargement des infos utilisateur",e),f(!1)}))}),[]);const g={backgroundColor:"#f44336",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"},h=e=>e.replace(/<script.*?>.*?<\/script>/gi,"").trim();return(0,t.createElement)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px",zIndex:1e3}},n?a?m?(0,t.createElement)("div",{className:"loader"},"Chargement en cours..."):(0,t.createElement)("div",null,(0,t.createElement)("h3",null,"Veuillez confirmer votre prise de rendez-vous ",d?l.user_firstName+" "+l.user_lastName:""),!d&&(0,t.createElement)("div",null,(0,t.createElement)("br",null),"Merci de renseigner vos informations personnelles",(0,t.createElement)("br",null),(0,t.createElement)("input",{type:"email",placeholder:"Votre email",value:l.user_mail}),(0,t.createElement)("input",{type:"text",placeholder:"Votre nom",value:l.user_lastName}),(0,t.createElement)("input",{type:"text",placeholder:"Votre prénom",value:l.user_firstName})),(0,t.createElement)("p",null,(0,t.createElement)("br",null),(0,t.createElement)("b",null,"Praticien :")," ",n.nom," ",n.prenom," - ",(0,t.createElement)("b",null,n.role),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"Prestation :")," ",(0,t.createElement)("b",null,a.prestation_name)," au tarif de ",(0,t.createElement)("b",null,a.prestation_cost)," pour une durée de ",(0,t.createElement)("b",null,a.prestation_duration),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"date du rendez-vous :")," le ",e.day," ",e.date," à ",(0,t.createElement)("b",null,e.time)),r&&(0,t.createElement)("p",null,(0,t.createElement)(i,{setObservation:s})),(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px"}},(0,t.createElement)("button",{style:{backgroundColor:"#4CAF50",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"},onClick:e=>{(e=>{if(e.preventDefault(),!d){if(!l.user_firstName||!l.user_lastName||!l.user_mail)return void alert("Veuillez remplir tous les champs requis.");l.user_firstName=h(l.user_firstName),l.user_lastName=h(l.user_lastName),l.user_mail=l.user_mail.replace(/[^a-zA-Z0-9@._-]/g,"").trim()}o(!0),u()})(e)}},"Valider"),(0,t.createElement)("button",{style:g,onClick:()=>{o(!1),u()}},"Annuler"))):(0,t.createElement)("div",null,"merci de choisir une prestation",(0,t.createElement)("button",{style:g,onClick:()=>{o(!1),u()}},"Annuler")):(0,t.createElement)("div",null,"merci de choisir un praticien",(0,t.createElement)("button",{style:g,onClick:()=>{o(!1),u()}},"Annuler")))},c=function({practician:e,prestation:n,selectedWeek:a,slot:o,setNewAppointment:r,dateTimeSlot:s,setDateTimeSlot:i,canWriteobservation:c,setObservation:u,userData:d,setUserData:p}){const[m,f]=(0,t.useState)(!1),[g,h]=(0,t.useState)(!1);if(!o)return null;const{time:y,isAvailable:v}=o,E=new Date("1970-01-01T"+y).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1}),b=(e,t)=>{const n=new Date,a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=new Date(e),[r,s]=t.split(":");return o.setHours(r,s,0,0),o<a||o.toDateString()===a.toDateString()&&o<n},T={padding:"5px",backgroundColor:v?m?"orange":"white":"#f44336",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px solid #ccc",cursor:!v||o.date&&b(o.date,y)?"not-allowed":"pointer",opacity:o.date&&b(o.date,y)?.5:1};return(0,t.createElement)("div",{onClick:()=>{v&&!g&&o.date&&!b(o.date,y)&&(i(o),h(!0),f(!0),console.log(`Plage horaire de ${y} pour une durée de X minutes cliquée.`))},onBlur:()=>{f(!1)},tabIndex:0,style:T},E,g&&(0,t.createElement)(l,{onClose:e=>{h(!1)},slot:o,setNewAppointment:r,practician:e,prestation:n,selectedWeek:a,dateTimeSlot:s,canWriteobservation:c,setObservation:u,setUserData:p,userData:d}))},u=({practician:e,prestation:n,selectedWeek:a,slotsByDay:o,daysOfWeek:r,setNewAppointment:s,dateTimeSlot:i,setDateTimeSlot:l,timeOfDay:u,canWriteobservation:d,setObservation:p,userData:m,setUserData:f})=>{const g=(e=>{const t=new Set;return Object.values(e).forEach((e=>{e.forEach((e=>{t.add(e.time)}))})),Array.from(t).sort()})(o),h=g.filter((e=>{const t=parseInt(e.split(":")[0]);return"AM"===u?t<12:t>=12})),y={width:100/r.length+"%",textAlign:"center",fontWeight:"bold"};return(0,t.createElement)("table",{style:{width:"100%",tableLayout:"fixed"}},(0,t.createElement)("thead",{style:{textAlign:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px"}},(0,t.createElement)("tr",null,r.map(((e,n)=>{const o=new Date(a.startDate);o.setDate(o.getDate()+n);const r=function(e){return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`}(o);return(0,t.createElement)("th",{key:e,style:{...y,fontWeight:"bolder"}},e,(0,t.createElement)("br",null),(0,t.createElement)("span",{style:{fontSize:"smaller",fontWeight:"normal"}},r))})))),(0,t.createElement)("tbody",null,h.map(((u,g)=>(0,t.createElement)("tr",{key:g},r.map(((r,g)=>{const h=o[r]?.find((e=>e.time===u))||{time:u,isAvailable:!1},v=new Date(a.startDate);v.setDate(v.getDate()+g);const E={...h,date:v.toISOString().split("T")[0]};return(0,t.createElement)("td",{key:r,style:y},(0,t.createElement)(c,{slot:E,setNewAppointment:s,practician:e,prestation:n,selectedWeek:a,dateTimeSlot:i,setDateTimeSlot:l,canWriteobservation:d,setObservation:p,setUserData:f,userData:m}))})))))))},d=function({onSelectionChange:e}){const[n,a]=(0,t.useState)("AM"),o=t=>{a(t.target.value),console.log(t.target.value),e(t.target.value)};return(0,t.createElement)("div",{style:{display:"flex",marginBottom:"10px"}},(0,t.createElement)("div",{style:{flex:1,display:"flex",justifyContent:"flex-end",alignItems:"center",marginRight:"10px"}},(0,t.createElement)("label",{style:{fontWeight:"bold"}},"Disponibilités")),(0,t.createElement)("div",{style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"}},(0,t.createElement)("label",{style:{display:"flex",alignItems:"center"}},(0,t.createElement)("input",{type:"radio",value:"AM",checked:"AM"===n,onChange:o}),"du matin"),(0,t.createElement)("label",{style:{display:"flex",alignItems:"center"}},(0,t.createElement)("input",{type:"radio",value:"PM",checked:"PM"===n,onChange:o}),"de l'après-midi")))};function p(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=p(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}var m=function(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=p(e))&&(a&&(a+=" "),a+=t);return a};const f=e=>"number"==typeof e&&!isNaN(e),g=e=>"string"==typeof e,h=e=>"function"==typeof e,y=e=>g(e)||h(e)?e:null,v=e=>(0,t.isValidElement)(e)||g(e)||h(e)||f(e);function E(e){let{enter:n,exit:a,appendPosition:o=!1,collapse:r=!0,collapseDuration:s=300}=e;return function(e){let{children:i,position:l,preventExitTransition:c,done:u,nodeRef:d,isIn:p}=e;const m=o?`${n}--${l}`:n,f=o?`${a}--${l}`:a,g=(0,t.useRef)(0);return(0,t.useLayoutEffect)((()=>{const e=d.current,t=m.split(" "),n=a=>{a.target===d.current&&(e.dispatchEvent(new Event("d")),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===g.current&&"animationcancel"!==a.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)}),[]),(0,t.useEffect)((()=>{const e=d.current,t=()=>{e.removeEventListener("animationend",t),r?function(e,t,n){void 0===n&&(n=300);const{scrollHeight:a,style:o}=e;requestAnimationFrame((()=>{o.minHeight="initial",o.height=a+"px",o.transition=`all ${n}ms`,requestAnimationFrame((()=>{o.height="0",o.padding="0",o.margin="0",setTimeout(t,n)}))}))}(e,u,s):u()};p||(c?t():(g.current=1,e.className+=` ${f}`,e.addEventListener("animationend",t)))}),[p]),t.createElement(t.Fragment,null,i)}}function b(e,t){return null!=e?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const T={list:new Map,emitQueue:new Map,on(e,t){return this.list.has(e)||this.list.set(e,[]),this.list.get(e).push(t),this},off(e,t){if(t){const n=this.list.get(e).filter((e=>e!==t));return this.list.set(e,n),this}return this.list.delete(e),this},cancelEmit(e){const t=this.emitQueue.get(e);return t&&(t.forEach(clearTimeout),this.emitQueue.delete(e)),this},emit(e){this.list.has(e)&&this.list.get(e).forEach((t=>{const n=setTimeout((()=>{t(...[].slice.call(arguments,1))}),0);this.emitQueue.has(e)||this.emitQueue.set(e,[]),this.emitQueue.get(e).push(n)}))}},w=e=>{let{theme:n,type:a,...o}=e;return t.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===n?"currentColor":`var(--toastify-icon-color-${a})`,...o})},_={info:function(e){return t.createElement(w,{...e},t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return t.createElement(w,{...e},t.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return t.createElement(w,{...e},t.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return t.createElement(w,{...e},t.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return t.createElement("div",{className:"Toastify__spinner"})}};function D(e){const[,n]=(0,t.useReducer)((e=>e+1),0),[a,o]=(0,t.useState)([]),r=(0,t.useRef)(null),s=(0,t.useRef)(new Map).current,i=e=>-1!==a.indexOf(e),l=(0,t.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:e,containerId:null,isToastActive:i,getToast:e=>s.get(e)}).current;function c(e){let{containerId:t}=e;const{limit:n}=l.props;!n||t&&l.containerId!==t||(l.count-=l.queue.length,l.queue=[])}function u(e){o((t=>null==e?[]:t.filter((t=>t!==e))))}function d(){const{toastContent:e,toastProps:t,staleId:n}=l.queue.shift();m(e,t,n)}function p(e,a){let{delay:o,staleId:i,...c}=a;if(!v(e)||function(e){return!r.current||l.props.enableMultiContainer&&e.containerId!==l.props.containerId||s.has(e.toastId)&&null==e.updateId}(c))return;const{toastId:p,updateId:E,data:w}=c,{props:D}=l,x=()=>u(p),S=null==E;S&&l.count++;const C={...D,style:D.toastStyle,key:l.toastKey++,...Object.fromEntries(Object.entries(c).filter((e=>{let[t,n]=e;return null!=n}))),toastId:p,updateId:E,data:w,closeToast:x,isIn:!1,className:y(c.className||D.toastClassName),bodyClassName:y(c.bodyClassName||D.bodyClassName),progressClassName:y(c.progressClassName||D.progressClassName),autoClose:!c.isLoading&&(I=c.autoClose,O=D.autoClose,!1===I||f(I)&&I>0?I:O),deleteToast(){const e=b(s.get(p),"removed");s.delete(p),T.emit(4,e);const t=l.queue.length;if(l.count=null==p?l.count-l.displayedToast:l.count-1,l.count<0&&(l.count=0),t>0){const e=null==p?l.props.limit:1;if(1===t||1===e)l.displayedToast++,d();else{const n=e>t?t:e;l.displayedToast=n;for(let e=0;e<n;e++)d()}}else n()}};var I,O;C.iconOut=function(e){let{theme:n,type:a,isLoading:o,icon:r}=e,s=null;const i={theme:n,type:a};return!1===r||(h(r)?s=r(i):(0,t.isValidElement)(r)?s=(0,t.cloneElement)(r,i):g(r)||f(r)?s=r:o?s=_.spinner():(e=>e in _)(a)&&(s=_[a](i))),s}(C),h(c.onOpen)&&(C.onOpen=c.onOpen),h(c.onClose)&&(C.onClose=c.onClose),C.closeButton=D.closeButton,!1===c.closeButton||v(c.closeButton)?C.closeButton=c.closeButton:!0===c.closeButton&&(C.closeButton=!v(D.closeButton)||D.closeButton);let N=e;(0,t.isValidElement)(e)&&!g(e.type)?N=(0,t.cloneElement)(e,{closeToast:x,toastProps:C,data:w}):h(e)&&(N=e({closeToast:x,toastProps:C,data:w})),D.limit&&D.limit>0&&l.count>D.limit&&S?l.queue.push({toastContent:N,toastProps:C,staleId:i}):f(o)?setTimeout((()=>{m(N,C,i)}),o):m(N,C,i)}function m(e,t,n){const{toastId:a}=t;n&&s.delete(n);const r={content:e,props:t};s.set(a,r),o((e=>[...e,a].filter((e=>e!==n)))),T.emit(4,b(r,null==r.props.updateId?"added":"updated"))}return(0,t.useEffect)((()=>(l.containerId=e.containerId,T.cancelEmit(3).on(0,p).on(1,(e=>r.current&&u(e))).on(5,c).emit(2,l),()=>{s.clear(),T.emit(3,l)})),[]),(0,t.useEffect)((()=>{l.props=e,l.isToastActive=i,l.displayedToast=a.length})),{getToastToRender:function(t){const n=new Map,a=Array.from(s.values());return e.newestOnTop&&a.reverse(),a.forEach((e=>{const{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)})),Array.from(n,(e=>t(e[0],e[1])))},containerRef:r,isToastActive:i}}function x(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientX:e.clientX}function S(e){return e.targetTouches&&e.targetTouches.length>=1?e.targetTouches[0].clientY:e.clientY}function C(e){const[n,a]=(0,t.useState)(!1),[o,r]=(0,t.useState)(!1),s=(0,t.useRef)(null),i=(0,t.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,l=(0,t.useRef)(e),{autoClose:c,pauseOnHover:u,closeToast:d,onClick:p,closeOnClick:m}=e;function f(t){if(e.draggable){"touchstart"===t.nativeEvent.type&&t.nativeEvent.preventDefault(),i.didMove=!1,document.addEventListener("mousemove",E),document.addEventListener("mouseup",b),document.addEventListener("touchmove",E),document.addEventListener("touchend",b);const n=s.current;i.canCloseOnClick=!0,i.canDrag=!0,i.boundingRect=n.getBoundingClientRect(),n.style.transition="",i.x=x(t.nativeEvent),i.y=S(t.nativeEvent),"x"===e.draggableDirection?(i.start=i.x,i.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(i.start=i.y,i.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent/100))}}function g(t){if(i.boundingRect){const{top:n,bottom:a,left:o,right:r}=i.boundingRect;"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&i.x>=o&&i.x<=r&&i.y>=n&&i.y<=a?v():y()}}function y(){a(!0)}function v(){a(!1)}function E(t){const a=s.current;i.canDrag&&a&&(i.didMove=!0,n&&v(),i.x=x(t),i.y=S(t),i.delta="x"===e.draggableDirection?i.x-i.start:i.y-i.start,i.start!==i.x&&(i.canCloseOnClick=!1),a.style.transform=`translate${e.draggableDirection}(${i.delta}px)`,a.style.opacity=""+(1-Math.abs(i.delta/i.removalDistance)))}function b(){document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",E),document.removeEventListener("touchend",b);const t=s.current;if(i.canDrag&&i.didMove&&t){if(i.canDrag=!1,Math.abs(i.delta)>i.removalDistance)return r(!0),void e.closeToast();t.style.transition="transform 0.2s, opacity 0.2s",t.style.transform=`translate${e.draggableDirection}(0)`,t.style.opacity="1"}}(0,t.useEffect)((()=>{l.current=e})),(0,t.useEffect)((()=>(s.current&&s.current.addEventListener("d",y,{once:!0}),h(e.onOpen)&&e.onOpen((0,t.isValidElement)(e.children)&&e.children.props),()=>{const e=l.current;h(e.onClose)&&e.onClose((0,t.isValidElement)(e.children)&&e.children.props)})),[]),(0,t.useEffect)((()=>(e.pauseOnFocusLoss&&(document.hasFocus()||v(),window.addEventListener("focus",y),window.addEventListener("blur",v)),()=>{e.pauseOnFocusLoss&&(window.removeEventListener("focus",y),window.removeEventListener("blur",v))})),[e.pauseOnFocusLoss]);const T={onMouseDown:f,onTouchStart:f,onMouseUp:g,onTouchEnd:g};return c&&u&&(T.onMouseEnter=v,T.onMouseLeave=y),m&&(T.onClick=e=>{p&&p(e),i.canCloseOnClick&&d()}),{playToast:y,pauseToast:v,isRunning:n,preventExitTransition:o,toastRef:s,eventHandlers:T}}function I(e){let{closeToast:n,theme:a,ariaLabel:o="close"}=e;return t.createElement("button",{className:`Toastify__close-button Toastify__close-button--${a}`,type:"button",onClick:e=>{e.stopPropagation(),n(e)},"aria-label":o},t.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},t.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function O(e){let{delay:n,isRunning:a,closeToast:o,type:r="default",hide:s,className:i,style:l,controlledProgress:c,progress:u,rtl:d,isIn:p,theme:f}=e;const g=s||c&&0===u,y={...l,animationDuration:`${n}ms`,animationPlayState:a?"running":"paused",opacity:g?0:1};c&&(y.transform=`scaleX(${u})`);const v=m("Toastify__progress-bar",c?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${f}`,`Toastify__progress-bar--${r}`,{"Toastify__progress-bar--rtl":d}),E=h(i)?i({rtl:d,type:r,defaultClassName:v}):m(v,i);return t.createElement("div",{role:"progressbar","aria-hidden":g?"true":"false","aria-label":"notification timer",className:E,style:y,[c&&u>=1?"onTransitionEnd":"onAnimationEnd"]:c&&u<1?null:()=>{p&&o()}})}const N=e=>{const{isRunning:n,preventExitTransition:a,toastRef:o,eventHandlers:r}=C(e),{closeButton:s,children:i,autoClose:l,onClick:c,type:u,hideProgressBar:d,closeToast:p,transition:f,position:g,className:y,style:v,bodyClassName:E,bodyStyle:b,progressClassName:T,progressStyle:w,updateId:_,role:D,progress:x,rtl:S,toastId:N,deleteToast:k,isIn:P,isLoading:A,iconOut:R,closeOnClick:L,theme:M}=e,$=m("Toastify__toast",`Toastify__toast-theme--${M}`,`Toastify__toast--${u}`,{"Toastify__toast--rtl":S},{"Toastify__toast--close-on-click":L}),j=h(y)?y({rtl:S,position:g,type:u,defaultClassName:$}):m($,y),B=!!x||!l,W={closeToast:p,type:u,theme:M};let F=null;return!1===s||(F=h(s)?s(W):(0,t.isValidElement)(s)?(0,t.cloneElement)(s,W):I(W)),t.createElement(f,{isIn:P,done:k,position:g,preventExitTransition:a,nodeRef:o},t.createElement("div",{id:N,onClick:c,className:j,...r,style:v,ref:o},t.createElement("div",{...P&&{role:D},className:h(E)?E({type:u}):m("Toastify__toast-body",E),style:b},null!=R&&t.createElement("div",{className:m("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!A})},R),t.createElement("div",null,i)),F,t.createElement(O,{..._&&!B?{key:`pb-${_}`}:{},rtl:S,theme:M,delay:l,isRunning:n,isIn:P,closeToast:p,hide:d,type:u,style:w,className:T,controlledProgress:B,progress:x||0})))},k=function(e,t){return void 0===t&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},P=E(k("bounce",!0)),A=(E(k("slide",!0)),E(k("zoom")),E(k("flip")),(0,t.forwardRef)(((e,n)=>{const{getToastToRender:a,containerRef:o,isToastActive:r}=D(e),{className:s,style:i,rtl:l,containerId:c}=e;function u(e){const t=m("Toastify__toast-container",`Toastify__toast-container--${e}`,{"Toastify__toast-container--rtl":l});return h(s)?s({position:e,rtl:l,defaultClassName:t}):m(t,y(s))}return(0,t.useEffect)((()=>{n&&(n.current=o.current)}),[]),t.createElement("div",{ref:o,className:"Toastify",id:c},a(((e,n)=>{const a=n.length?{...i}:{...i,pointerEvents:"none"};return t.createElement("div",{className:u(e),style:a,key:`container-${e}`},n.map(((e,a)=>{let{content:o,props:s}=e;return t.createElement(N,{...s,isIn:r(s.toastId),style:{...s.style,"--nth":a+1,"--len":n.length},key:`toast-${s.key}`},o)})))})))})));A.displayName="ToastContainer",A.defaultProps={position:"top-right",transition:P,autoClose:5e3,closeButton:I,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let R,L=new Map,M=[],$=1;function j(){return""+$++}function B(e){return e&&(g(e.toastId)||f(e.toastId))?e.toastId:j()}function W(e,t){return L.size>0?T.emit(0,e,t):M.push({content:e,options:t}),t.toastId}function F(e,t){return{...t,type:t&&t.type||e,toastId:B(t)}}function z(e){return(t,n)=>W(t,F(e,n))}function H(e,t){return W(e,F("default",t))}H.loading=(e,t)=>W(e,F("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),H.promise=function(e,t,n){let a,{pending:o,error:r,success:s}=t;o&&(a=g(o)?H.loading(o,n):H.loading(o.render,{...n,...o}));const i={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(e,t,o)=>{if(null==t)return void H.dismiss(a);const r={type:e,...i,...n,data:o},s=g(t)?{render:t}:t;return a?H.update(a,{...r,...s}):H(s.render,{...r,...s}),o},c=h(e)?e():e;return c.then((e=>l("success",s,e))).catch((e=>l("error",r,e))),c},H.success=z("success"),H.info=z("info"),H.error=z("error"),H.warning=z("warning"),H.warn=H.warning,H.dark=(e,t)=>W(e,F("default",{theme:"dark",...t})),H.dismiss=e=>{L.size>0?T.emit(1,e):M=M.filter((t=>null!=e&&t.options.toastId!==e))},H.clearWaitingQueue=function(e){return void 0===e&&(e={}),T.emit(5,e)},H.isActive=e=>{let t=!1;return L.forEach((n=>{n.isToastActive&&n.isToastActive(e)&&(t=!0)})),t},H.update=function(e,t){void 0===t&&(t={}),setTimeout((()=>{const n=function(e,t){let{containerId:n}=t;const a=L.get(n||R);return a&&a.getToast(e)}(e,t);if(n){const{props:a,content:o}=n,r={delay:100,...a,...t,toastId:t.toastId||e,updateId:j()};r.toastId!==e&&(r.staleId=e);const s=r.render||o;delete r.render,W(s,r)}}),0)},H.done=e=>{H.update(e,{progress:1})},H.onChange=e=>(T.on(4,e),()=>{T.off(4,e)}),H.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},H.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},T.on(2,(e=>{R=e.containerId||e,L.set(R,e),M.forEach((e=>{T.emit(0,e.content,e.options)})),M=[]})).on(3,(e=>{L.delete(e.containerId||e),0===L.size&&T.off(0).off(1).off(5)}));var U=({options:e,practician:n,prestation:a,selectedPractitionerId:o,selectedWeek:r,participants:s})=>{const[i,l]=(0,t.useState)(["e","r"]),[c,p]=(0,t.useState)(!1),[m,f]=(0,t.useState)([]),[g,h]=(0,t.useState)(!1),[y,v]=(0,t.useState)(null),[E,b]=(0,t.useState)(null),[T,w]=(0,t.useState)("AM"),[_,D]=(0,t.useState)({user_mail:"",user_id:"",user_name:"",user_firstName:"",user_lastName:"",user_phone:""}),x=(0,t.useRef)(!1);(0,t.useEffect)((()=>(x.current=!0,()=>{x.current=!1})),[]);(0,t.useEffect)((()=>{g&&(async(e,t,n,a,o,r,s,i,l)=>{const c={practician_id:e,prestation_id:t,prestation_duration:n,rdv_dateTime:a,rdv_status:1,customer_id:r,participants:parseInt(s),observation:i,userData:l};try{const e=await fetch("/wp-json/booker67/v1/add-rdv/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),t=await e.json();console.log("Succès:",t),H("Demande de rendez-vous envoyée. Un mail de confirmation vous sera envoyé.",{className:"custom-toast-succes",position:H.POSITION.TOP_CENTER,autoClose:3e3}),C().then(S()),((e,t,n,a)=>{const o={method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify({to:"destinataire@example.com",subject:"Sujet de Test",html:"Ceci est un message de test.",text:void 0})};fetch("/wp-json/booking67/v1/send-mail",o).then((e=>e.json())).then((e=>{e.code&&"email_send_error"===e.code?console.error("Erreur lors de l’envoi de l’email:",e.message):console.log("Email envoyé avec succès:",e)})).catch((e=>{console.error("Erreur:",e)}))})()}catch(e){console.error("Erreur:",e),H("Une erreur c'est produite, veuillez recommencer",{className:"custom-toast-alert",position:H.POSITION.TOP_CENTER,autoClose:3e3})}})(n.id,a.id,a.prestation_duration,function(e,t){const[n,a,o]=e.split("-");return console.log([n,a,o]),new Date(`${n}-${a}-${o}T${t}`)}(E.date,E.time),0,null,s,y,_)}),[g]);const S=async()=>{if(console.log("fetch appointments"),o&&0!==o||!e.multiplePracticians&&1===o){let t=0;t=e.multiplePracticians?o:1;try{const e=await fetch(`/wp-json/booker67/v1/appointments/${t}`);let n=(await e.json()).map((e=>{const t=new Date(e.rdv_dateTime+"Z");return{...e,rdv_dateTime:t.toLocaleString("fr-FR",{timeZone:"Europe/Paris"})}}));x.current&&f(n)}catch(e){console.error("Erreur lors de la récupération des rendez-vous:",e)}}},C=async()=>{if(console.log("fetch availability"),o&&0!==o)try{const e=await fetch(`/wp-json/booker67/v1/availability/${o}`),t=await e.json(),n=new Date(r.startDate),a=new Date(r.endDate),s=O(n),i=I(t,m,s),c=N(i,n,a,s);x.current&&l(c)}catch(e){console.error("Erreur lors de la récupération des disponibilités:",e)}};(0,t.useEffect)((()=>{console.log("useeffect fetch appoitments"),S()}),[o,e.multipleAppointments]),(0,t.useEffect)((()=>{console.log("useeffect fetch availability"),C()}),[o,m,r,e.multipleAppointments]);const I=(t,n,a)=>{console.log("calculate free slots"),p(!0);let o=[],r=new Map,s=new Map;return e.multipleAppointments?(console.log("multiappointment mode"),n.forEach((e=>{const[t,n]=e.rdv_dateTime.split(" "),[a,o,r]=t.split("/"),[i,l,c]=n.split(":");new Date(r,o-1,a,i,l,c);let u=`${a.padStart(2,"0")}/${o.padStart(2,"0")}/${r} ${i.padStart(2,"0")}:${l.padStart(2,"0")}`,d=s.get(u)||0;s.set(u,d+1)})),t.forEach((t=>{let n=t.day_name.charAt(0).toUpperCase()+t.day_name.slice(1),r=a.get(n);if(r){let a=new Date(r);a.setHours(t.opening_time.split(":")[0],t.opening_time.split(":")[1],0);let i=new Date(r);i.setHours(t.closing_time.split(":")[0],t.closing_time.split(":")[1],0);let l=[];for(;a<i;){let t=`${a.getDate().toString().padStart(2,"0")}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getFullYear()} ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`,n=s.get(t)||0,o=parseInt(e.maxAppointments);(0===o||n<=o)&&l.push(new Date(a)),a.setMinutes(a.getMinutes()+parseInt(e.slotDuration))}l.length>0&&(o=o.concat(l.map((e=>({day:n,date:e.toLocaleDateString("fr-FR"),time:e.toLocaleTimeString("fr-FR")})))))}}))):(t.forEach((t=>{let n=t.day_name.charAt(0).toUpperCase()+t.day_name.slice(1),o=a.get(n);if(o){let a=new Date(o);a.setHours(t.opening_time.split(":")[0],t.opening_time.split(":")[1],0);let s=new Date(o);s.setHours(t.closing_time.split(":")[0],t.closing_time.split(":")[1],0);let i=[];for(;a<s;)i.push(new Date(a)),a.setMinutes(a.getMinutes()+parseInt(e.slotDuration));r.set(n,i)}})),n.forEach((e=>{const[t,n]=e.rdv_dateTime.split(" "),[a,o,s]=t.split("/"),[i,l,c]=n.split(":");let u=new Date(s,o-1,a,i,l,c),d=parseInt(e.prestation_duration.split(":")[0]),p=parseInt(e.prestation_duration.split(":")[1]||"0"),m=new Date(u);m.setHours(m.getHours()+d),m.setMinutes(m.getMinutes()+p);let f=u.toLocaleDateString("fr-FR",{weekday:"long"});f=f.charAt(0).toUpperCase()+f.slice(1);let g=r.get(f);g&&r.set(f,g.filter((e=>e<u||e>=m)))})),r.forEach(((e,t)=>{e.forEach((e=>{let n=e.toLocaleDateString("fr-FR");o.push({day:t,date:n,time:e.toLocaleTimeString("fr-FR")})}))}))),p(!1),o},O=e=>{let t=new Map;for(;1!==e.getDay();)e.setDate(e.getDate()-1);for(let n=0;n<7;n++){let a=new Date(e);a.setDate(e.getDate()+n);let o=a.toLocaleDateString("fr-FR",{weekday:"long"});o=o.charAt(0).toUpperCase()+o.slice(1),t.set(o,a)}return t},N=(e,t,n,a)=>e.filter((e=>{const o=a.get(e.day);return o&&o>=t&&o<=n})),k=new Date(r.startDate),P=new Date(r.endDate),A=O(k),R=N(i,k,P,A).reduce(((e,t)=>(e[t.day]=e[t.day]||[],e[t.day].push({...t,isAvailable:!0}),e)),{});return(0,t.createElement)("div",null,c?(0,t.createElement)("div",{className:"loader"},"Chargement..."):i.length>0?(0,t.createElement)("div",null,(0,t.createElement)(d,{onSelectionChange:e=>{w(e)}}),(0,t.createElement)(u,{slotsByDay:R,practician:n,prestation:a,selectedWeek:r,setNewAppointment:h,daysOfWeek:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],dateTimeSlot:E,setDateTimeSlot:b,timeOfDay:T,canWriteobservation:e.allowObservations,setObservation:v,setUserData:D,userData:_})):(0,t.createElement)("p",null,"Aucun créneau disponible pour cette semaine."))},V=({onWeekChange:e})=>{const n=(new Date).toISOString().split("T")[0],[a,o]=(0,t.useState)(n);return(0,t.createElement)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"10px"}},(0,t.createElement)("label",{htmlFor:"weekSelectorInput",style:{fontWeight:"bold",display:"block",marginBottom:"5px"}},"Semaine du "),(0,t.createElement)("input",{type:"date",id:"weekSelectorInput",className:"weekSelector",value:a,onChange:t=>{o(t.target.value);let n=(e=>{const t=new Date(e);t.setDate(t.getDate()-t.getDay()+1);const n=new Date(t);return n.setDate(n.getDate()+6),{startDate:t,endDate:n}})(new Date(t.target.value));e(n),console.log(n)},min:n}))},q=function({onNumberChange:e}){const[n,a]=(0,t.useState)(1);return(0,t.createElement)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"10px"}},(0,t.createElement)("label",{htmlFor:"number-of-participants",style:{fontWeight:"bold",display:"block",marginBottom:"5px"}},"Participants :"),(0,t.createElement)("select",{id:"number-of-participants",value:n,onChange:t=>{e(t.target.value),a(t.target.value)}},Array.from({length:50},((e,n)=>(0,t.createElement)("option",{key:n+1,value:n+1},n+1)))))};const Q=()=>{const[e,n]=(0,t.useState)({hasFixedTimeSlots:!1,slotDuration:30,multipleAppointments:!1,maxAppointments:0,multiplePracticians:!0,multiPrestations:!0,indicateNumberOfParticipants:!1,allowObservations:!1,participants:1}),[a,o]=(0,t.useState)(0),[i,l]=(0,t.useState)(0),[c,u]=(0,t.useState)(null),[d,p]=(0,t.useState)(null),[m,f]=(0,t.useState)(1);(0,t.useEffect)((()=>{(async function(e){try{let t=new URL("https://wordpress-react-test.local/wp-json/booker67/v1/options/filter");e.forEach((e=>t.searchParams.append("types[]",e)));const n=await fetch(t);if(!n.ok)throw new Error("Erreur réseau ou serveur");const a=await n.json();return console.log("Options récupérées:",a),a}catch(e){console.error("Erreur lors de la récupération des options:",e)}})(["genType_hasFixedTimeSlots","genType_multipleAppointments","genType_slotDuration","genType_maxAppointments","genType_multiplePracticians","genType_multiPrestations","genType_indicateNumberOfParticipants","genType_allowObservations"]).then((e=>{n(g(e))})),e.multiplePracticians,v(1),e.multiPrestations||E(1)}),[a]);const g=t=>{let n={...e};return t.forEach((e=>{const t=e.generic_type.replace("genType_","");n[t]="true"===e.value||"false"===e.value?"true"===e.value:e.value})),n},[h,y]=(0,t.useState)({startDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+1),t.toISOString().split("T")[0]})(),endDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+7),t.toISOString().split("T")[0]})()}),v=async e=>{const t=`/wp-json/booker67/v1/human-ressource/${e}`;try{const n=await fetch(t);if(!n.ok)throw new Error("Erreur réseau lors de la récupération des données");const r=await n.json();u(r),a!==e&&o(e)}catch(e){console.error("Erreur lors de la récupération des données:",e)}},E=async e=>{console.log("handleprestation change"),l(e);const t=`/wp-json/booker67/v1/prestation/${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error("Erreur réseau lors de la récupération de la prestation");const n=await e.json();p(n)}catch(e){console.error("Erreur lors de la récupération de la prestation:",e)}};return(0,t.createElement)("div",null,(0,t.createElement)(A,null),(0,t.createElement)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-between",marginBottom:"20px"}},e.multiplePracticians&&(0,t.createElement)("div",{style:{flexBasis:"48%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,t.createElement)(s,{onPractitionerChange:v})),e.multiPrestations&&(0,t.createElement)("div",{style:{flexBasis:"48%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,t.createElement)(r,{practitionerId:a,onPrestationChange:E})),e.indicateNumberOfParticipants&&(0,t.createElement)("div",{style:{flexBasis:"48%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,t.createElement)(q,{onNumberChange:e=>{f(e)}})),(0,t.createElement)("div",{style:{flexBasis:e.indicateNumberOfParticipants?"48%":"100%",display:"flex",justifyContent:"center",alignItems:"center"}},(0,t.createElement)(V,{onWeekChange:e=>{y(e)}}))),a&&(0,t.createElement)("div",{style:{width:"100%"}},(0,t.createElement)(U,{options:e,practician:c,prestation:d,selectedPractitionerId:a,selectedWeek:h,participants:m})))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("booking67-root");e&&a().render((0,t.createElement)(Q,null),e)}))}();