!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.ReactDOM,r=e.n(n),a=window.wp.element,o=function({practitionerId:e,onPrestationChange:n}){const[r,o]=(0,a.useState)([]);return(0,a.useEffect)((()=>{let t="/wp-json/booker67/v1/prestations";e&&(t+=`/practitioner_id/${e}`),fetch(t).then((e=>e.json())).then((e=>{o(e)})).catch((e=>{console.error("Erreur lors de la récupération des prestations:",e)}))}),[e]),console.log("prestations for practician: ",r),(0,t.createElement)("select",{onChange:e=>{n(e.target.value)}},(0,t.createElement)("option",{value:""},"Sélectionnez une prestation"),r.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.prestation_name," - ",e.prestation_cost," - ",e.prestation_duration))))},l=function({onPractitionerChange:e}){const[n,r]=(0,t.useState)([]);return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{r(e)}))}),[]),(0,t.createElement)("div",null,(0,t.createElement)("select",{id:"humanRessourceSelect",onChange:t=>{e(t.target.value)}},(0,t.createElement)("option",{value:""},"Choisir un praticien"),n.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},i=({dateTimeSlot:e,practician:n,prestation:r,selectedWeek:a,setNewAppointment:o,slot:l,onClose:i})=>{console.log(e);const s={backgroundColor:"#f44336",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"};return(0,t.createElement)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px",zIndex:1e3}},n?r?(0,t.createElement)("div",null,(0,t.createElement)("h3",null,"Veuillez confirmer votre prise de rendez-vous"),(0,t.createElement)("p",null,(0,t.createElement)("br",null),(0,t.createElement)("b",null,"Praticien :")," ",n.nom," ",n.prenom," - ",(0,t.createElement)("b",null,n.role),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"Prestation :")," ",(0,t.createElement)("b",null,r.prestation_name)," au tarif de ",(0,t.createElement)("b",null,r.prestation_cost)," pour une durée de ",(0,t.createElement)("b",null,r.prestation_duration),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"date du rendez-vous :"),"  le ",e.day," ",e.date," à ",(0,t.createElement)("b",null,e.time)),(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px"}},(0,t.createElement)("button",{style:{backgroundColor:"#4CAF50",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"},onClick:()=>{o(!0),i()}},"Valider"),(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler"))):(0,t.createElement)("div",null,"merci de choisir une prestation",(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler")):(0,t.createElement)("div",null,"merci de choisir un praticien",(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler")))},s=function({practician:e,prestation:n,selectedWeek:r,slot:a,setNewAppointment:o,dateTimeSlot:l,setDateTimeSlot:s}){const[c,u]=(0,t.useState)(!1),[d,p]=(0,t.useState)(!1);if(!a)return null;const{time:m,isAvailable:h}=a,g=new Date("1970-01-01T"+m).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1}),E={cursor:"pointer",padding:"5px",backgroundColor:h?c?"orange":"white":"red",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px solid #ccc"};return(0,t.createElement)("div",{onClick:()=>{h&&!d&&(s(a),p(!0),u(!0),console.log(`Plage horaire de ${m} pour une durée de X minutes cliquée.`))},onBlur:()=>{u(!1)},tabIndex:0,style:E},g,d&&(0,t.createElement)(i,{onClose:e=>{p(!1)},slot:a,setNewAppointment:o,practician:e,prestation:n,selectedWeek:r,dateTimeSlot:l}))},c=({practician:e,prestation:n,selectedWeek:r,slotsByDay:a,daysOfWeek:o,setNewAppointment:l,dateTimeSlot:i,setDateTimeSlot:c})=>{const u=(e=>{const t=new Set;return Object.values(e).forEach((e=>{e.forEach((e=>{t.add(e.time)}))})),Array.from(t).sort()})(a),d={width:100/o.length+"%",textAlign:"center",fontWeight:"bold"};return(0,t.createElement)("table",{style:{width:"100%",tableLayout:"fixed"}},(0,t.createElement)("thead",{style:{textAlign:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px"}},(0,t.createElement)("tr",null,o.map((e=>(0,t.createElement)("th",{key:e},e))))),(0,t.createElement)("tbody",null,u.map(((u,p)=>(0,t.createElement)("tr",{key:p},o.map((o=>{const p=a[o]?.find((e=>e.time===u))||{time:u,isAvailable:!1};return(0,t.createElement)("td",{key:o,style:d},(0,t.createElement)(s,{slot:p,setNewAppointment:l,practician:e,prestation:n,selectedWeek:r,dateTimeSlot:i,setDateTimeSlot:c}))})))))))},u=function({onSelectionChange:e}){const[n,r]=(0,t.useState)(""),a=t=>{r(t.target.value),e(t.target.value)};return(0,t.createElement)("div",null,(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"AM",checked:"AM"===n,onChange:a}),"Matin"),(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"PM",checked:"PM"===n,onChange:a}),"Après-midi"))},d=({practician:e,prestation:n,selectedPractitionerId:r,selectedWeek:a})=>{const[o,l]=(0,t.useState)(["e","r"]),[i,s]=(0,t.useState)([]),[d,p]=(0,t.useState)(!1),[m,h]=(0,t.useState)(null);(0,t.useEffect)((()=>{d&&function(e,t,n,r,a,o){const l={practician_id:e,prestation_id:t,prestation_duration:n,rdv_dateTime:r,rdv_status:1,customer_id:void 0};fetch("/wp-json/booker67/v1/add-rdv/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>e.json())).then((e=>{console.log("Succès:",e)})).catch((e=>{console.error("Erreur:",e)}))}(e.id,n.id,n.prestation_duration,function(e,t){const[n,r,a]=e.split("/");return new Date(`${a}-${r}-${n}T${t}`)}(m.date,m.time))}),[d]),(0,t.useEffect)((()=>{0!==r&&fetch(`/wp-json/booker67/v1/appointments/${r}`).then((e=>e.json())).then((e=>{console.log("appoitements: ",e),s(e)})).catch((e=>{console.error("Erreur lors de la récupération des rendez-vous:",e)}))}),[r]),(0,t.useEffect)((()=>{0!==r&&fetch(`/wp-json/booker67/v1/availability/${r}`).then((e=>e.json())).then((e=>{const t=new Date(a.startDate),n=new Date(a.endDate),r=E(t),o=g(e,i,r),s=f(o,t,n,r);l(s)})).catch((e=>{console.error("Erreur lors de la récupération des disponibilités:",e)}))}),[r,i,a]);const g=(e,t,n)=>{let r=[],a=new Map;return e.forEach((e=>{let t=e.day_name.charAt(0).toUpperCase()+e.day_name.slice(1),r=n.get(t);if(r){let n=new Date(r);n.setHours(e.opening_time.split(":")[0],e.opening_time.split(":")[1],0);let o=new Date(r);o.setHours(e.closing_time.split(":")[0],e.closing_time.split(":")[1],0);let l=[];for(;n<o;)l.push(new Date(n)),n.setMinutes(n.getMinutes()+30);a.set(t,l)}})),t.forEach((e=>{let t=new Date(e.rdv_dateTime),n=parseInt(e.prestation_duration.split(":")[0]),r=parseInt(e.prestation_duration.split(":")[1]||"0"),o=new Date(t);o.setHours(o.getHours()+n),o.setMinutes(o.getMinutes()+r);let l=t.toLocaleDateString("fr-FR",{weekday:"long"});l=l.charAt(0).toUpperCase()+l.slice(1);let i=a.get(l);i&&a.set(l,i.filter((e=>e<t||e>=o)))})),a.forEach(((e,t)=>{e.forEach((e=>{let n=e.toLocaleDateString("fr-FR");r.push({day:t,date:n,time:e.toLocaleTimeString("fr-FR")})}))})),r},E=e=>{let t=new Map;for(;1!==e.getDay();)e.setDate(e.getDate()-1);for(let n=0;n<7;n++){let r=new Date(e);r.setDate(e.getDate()+n);let a=r.toLocaleDateString("fr-FR",{weekday:"long"});a=a.charAt(0).toUpperCase()+a.slice(1),t.set(a,r)}return t},f=(e,t,n,r)=>e.filter((e=>{const a=r.get(e.day);return a&&a>=t&&a<=n})),b=new Date(a.startDate),w=new Date(a.endDate),D=E(b),y=f(o,b,w,D).reduce(((e,t)=>(e[t.day]=e[t.day]||[],e[t.day].push({...t,isAvailable:!0}),e)),{});return(0,t.createElement)("div",null,o.length>0?(0,t.createElement)("div",null,(0,t.createElement)(u,null),(0,t.createElement)(c,{slotsByDay:y,practician:e,prestation:n,selectedWeek:a,setNewAppointment:p,daysOfWeek:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],dateTimeSlot:m,setDateTimeSlot:h})):(0,t.createElement)("p",null,"Aucun créneau disponible pour cette semaine."))},p=({onWeekChange:e})=>{const n=(new Date).toISOString().split("T")[0],[r,a]=(0,t.useState)(n);return(0,t.createElement)("input",{type:"date",value:r,onChange:t=>{a(t.target.value);let n=(e=>{const t=new Date(e);t.setDate(t.getDate()-t.getDay()+1);const n=new Date(t);return n.setDate(n.getDate()+6),{startDate:t,endDate:n}})(new Date(t.target.value));e(n),console.log(n)}})};const m=()=>{const[e,n]=(0,t.useState)(0),[r,a]=(0,t.useState)(0),[i,s]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),[m,h]=(0,t.useState)([]),[g,E]=(0,t.useState)({startDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+1),t.toISOString().split("T")[0]})(),endDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+7),t.toISOString().split("T")[0]})()});return(0,t.createElement)("div",null,(0,t.createElement)(l,{onPractitionerChange:e=>{n(e),fetch(`/wp-json/booker67/v1/human-ressource/${e}`).then((e=>{if(!e.ok)throw new Error("Erreur réseau lors de la récupération des données");return e.json()})).then((e=>{s(e)})).catch((e=>{console.error("Erreur lors de la récupération des données:",e)}))}}),(0,t.createElement)(o,{practitionerId:e,onPrestationChange:e=>{a(e),fetch(`/wp-json/booker67/v1/prestation/${e}`).then((e=>{if(!e.ok)throw new Error("Erreur réseau lors de la récupération de la prestation");return e.json()})).then((e=>{u(e),console.log("prestation change choisi: ",c)})).catch((e=>{console.error("Erreur lors de la récupération de la prestation:",e)}))}}),(0,t.createElement)(p,{onWeekChange:e=>{E(e)}}),0!==e&&(0,t.createElement)(d,{practician:i,prestation:c,selectedPractitionerId:e,selectedWeek:g}))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("booking67-root");e&&r().render((0,t.createElement)(m,null),e)}))}();