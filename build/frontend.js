!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.ReactDOM,r=e.n(n),a=window.wp.element,o=function({practitionerId:e,onPrestationChange:n}){const[r,o]=(0,a.useState)([]);return(0,a.useEffect)((()=>{let t="/wp-json/booker67/v1/prestations";e&&(t+=`/practitioner_id/${e}`),fetch(t).then((e=>e.json())).then((e=>{o(e)})).catch((e=>{console.error("Erreur lors de la récupération des prestations:",e)}))}),[e]),console.log("prestations for practician: ",r),(0,t.createElement)("select",{onChange:e=>{n(e.target.value)}},(0,t.createElement)("option",{value:""},"Sélectionnez une prestation"),r.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.prestation_name," - ",e.prestation_cost," - ",e.prestation_duration))))},l=function({onPractitionerChange:e}){const[n,r]=(0,t.useState)([]);return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{r(e)}))}),[]),(0,t.createElement)("div",null,(0,t.createElement)("select",{id:"humanRessourceSelect",onChange:t=>{e(t.target.value)}},(0,t.createElement)("option",{value:"1"}),n.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},i=({dateTimeSlot:e,practician:n,prestation:r,selectedWeek:a,setNewAppointment:o,slot:l,onClose:i})=>{console.log(e);const s={backgroundColor:"#f44336",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"};return(0,t.createElement)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px",zIndex:1e3}},n?r?(0,t.createElement)("div",null,(0,t.createElement)("h3",null,"Veuillez confirmer votre prise de rendez-vous"),(0,t.createElement)("p",null,(0,t.createElement)("br",null),(0,t.createElement)("b",null,"Praticien :")," ",n.nom," ",n.prenom," - ",(0,t.createElement)("b",null,n.role),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"Prestation :")," ",(0,t.createElement)("b",null,r.prestation_name)," au tarif de ",(0,t.createElement)("b",null,r.prestation_cost)," pour une durée de ",(0,t.createElement)("b",null,r.prestation_duration),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"date du rendez-vous :"),"  le ",e.day," ",e.date," à ",(0,t.createElement)("b",null,e.time)),(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px"}},(0,t.createElement)("button",{style:{backgroundColor:"#4CAF50",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"},onClick:()=>{o(!0),i()}},"Valider"),(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler"))):(0,t.createElement)("div",null,"merci de choisir une prestation",(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler")):(0,t.createElement)("div",null,"merci de choisir un praticien",(0,t.createElement)("button",{style:s,onClick:()=>{o(!1),i()}},"Annuler")))},s=function({practician:e,prestation:n,selectedWeek:r,slot:a,setNewAppointment:o,dateTimeSlot:l,setDateTimeSlot:s}){const[c,u]=(0,t.useState)(!1),[p,d]=(0,t.useState)(!1);if(!a)return null;const{time:m,isAvailable:g}=a,h=new Date("1970-01-01T"+m).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1}),E={cursor:"pointer",padding:"5px",backgroundColor:g?c?"orange":"white":"red",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px solid #ccc"};return(0,t.createElement)("div",{onClick:()=>{g&&!p&&(s(a),d(!0),u(!0),console.log(`Plage horaire de ${m} pour une durée de X minutes cliquée.`))},onBlur:()=>{u(!1)},tabIndex:0,style:E},h,p&&(0,t.createElement)(i,{onClose:e=>{d(!1)},slot:a,setNewAppointment:o,practician:e,prestation:n,selectedWeek:r,dateTimeSlot:l}))},c=({practician:e,prestation:n,selectedWeek:r,slotsByDay:a,daysOfWeek:o,setNewAppointment:l,dateTimeSlot:i,setDateTimeSlot:c,timeOfDay:u})=>{const p=(e=>{const t=new Set;return Object.values(e).forEach((e=>{e.forEach((e=>{t.add(e.time)}))})),Array.from(t).sort()})(a),d=p.filter((e=>{const t=parseInt(e.split(":")[0]);return"AM"===u?t<12:t>=12})),m={width:100/o.length+"%",textAlign:"center",fontWeight:"bold"};return(0,t.createElement)("table",{style:{width:"100%",tableLayout:"fixed"}},(0,t.createElement)("thead",{style:{textAlign:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px"}},(0,t.createElement)("tr",null,o.map((e=>(0,t.createElement)("th",{key:e},e))))),(0,t.createElement)("tbody",null,d.map(((u,p)=>(0,t.createElement)("tr",{key:p},o.map((o=>{const p=a[o]?.find((e=>e.time===u))||{time:u,isAvailable:!1};return(0,t.createElement)("td",{key:o,style:m},(0,t.createElement)(s,{slot:p,setNewAppointment:l,practician:e,prestation:n,selectedWeek:r,dateTimeSlot:i,setDateTimeSlot:c}))})))))))},u=function({onSelectionChange:e}){const[n,r]=(0,t.useState)("AM"),a=t=>{r(t.target.value),console.log(t.target.value),e(t.target.value)};return(0,t.createElement)("div",null,(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"AM",checked:"AM"===n,onChange:a}),"Matin"),(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"PM",checked:"PM"===n,onChange:a}),"Après-midi"))};window.wp["components/buildTypes/utils/values"];var p=({options:e,practician:n,prestation:r,selectedPractitionerId:a,selectedWeek:o})=>{const[l,i]=(0,t.useState)(["e","r"]),[s,p]=(0,t.useState)([]),[d,m]=(0,t.useState)(!1),[g,h]=(0,t.useState)(null),[E,f]=(0,t.useState)("AM");(0,t.useEffect)((()=>{d&&function(e,t,n,r,a,o){const l={practician_id:e,prestation_id:t,prestation_duration:n,rdv_dateTime:r,rdv_status:1,customer_id:void 0};fetch("/wp-json/booker67/v1/add-rdv/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>e.json())).then((e=>{console.log("Succès:",e)})).catch((e=>{console.error("Erreur:",e)}))}(n.id,r.id,r.prestation_duration,function(e,t){const[n,r,a]=e.split("/");return new Date(`${a}-${r}-${n}T${t}`)}(g.date,g.time))}),[d]),(0,t.useEffect)((()=>{0!==a&&fetch(`/wp-json/booker67/v1/appointments/${a}`).then((e=>e.json())).then((e=>{console.log("appoitements: ",e),p(e)})).catch((e=>{console.error("Erreur lors de la récupération des rendez-vous:",e)}))}),[a]),(0,t.useEffect)((()=>{0!==a&&fetch(`/wp-json/booker67/v1/availability/${a}`).then((e=>e.json())).then((e=>{const t=new Date(o.startDate),n=new Date(o.endDate),r=b(t),a=w(e,s,r),l=y(a,t,n,r);i(l)})).catch((e=>{console.error("Erreur lors de la récupération des disponibilités:",e)}))}),[a,s,o]);const w=(t,n,r)=>{let a=[],o=new Map;return t.forEach((t=>{let n=t.day_name.charAt(0).toUpperCase()+t.day_name.slice(1),a=r.get(n);if(a){let r=new Date(a);r.setHours(t.opening_time.split(":")[0],t.opening_time.split(":")[1],0);let l=new Date(a);l.setHours(t.closing_time.split(":")[0],t.closing_time.split(":")[1],0);let i=[];for(;r<l;)i.push(new Date(r)),r.setMinutes(r.getMinutes()+parseInt(e.slotDuration));o.set(n,i)}})),n.forEach((e=>{let t=new Date(e.rdv_dateTime),n=parseInt(e.prestation_duration.split(":")[0]),r=parseInt(e.prestation_duration.split(":")[1]||"0"),a=new Date(t);a.setHours(a.getHours()+n),a.setMinutes(a.getMinutes()+r);let l=t.toLocaleDateString("fr-FR",{weekday:"long"});l=l.charAt(0).toUpperCase()+l.slice(1);let i=o.get(l);i&&o.set(l,i.filter((e=>e<t||e>=a)))})),o.forEach(((e,t)=>{e.forEach((e=>{let n=e.toLocaleDateString("fr-FR");a.push({day:t,date:n,time:e.toLocaleTimeString("fr-FR")})}))})),a},b=e=>{let t=new Map;for(;1!==e.getDay();)e.setDate(e.getDate()-1);for(let n=0;n<7;n++){let r=new Date(e);r.setDate(e.getDate()+n);let a=r.toLocaleDateString("fr-FR",{weekday:"long"});a=a.charAt(0).toUpperCase()+a.slice(1),t.set(a,r)}return t},y=(e,t,n,r)=>e.filter((e=>{const a=r.get(e.day);return a&&a>=t&&a<=n})),D=new Date(o.startDate),v=new Date(o.endDate),S=b(D),x=y(l,D,v,S).reduce(((e,t)=>(e[t.day]=e[t.day]||[],e[t.day].push({...t,isAvailable:!0}),e)),{});return(0,t.createElement)("div",null,l.length>0?(0,t.createElement)("div",null,(0,t.createElement)(u,{onSelectionChange:e=>{f(e)}}),(0,t.createElement)(c,{slotsByDay:x,practician:n,prestation:r,selectedWeek:o,setNewAppointment:m,daysOfWeek:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],dateTimeSlot:g,setDateTimeSlot:h,timeOfDay:E})):(0,t.createElement)("p",null,"Aucun créneau disponible pour cette semaine."))},d=({onWeekChange:e})=>{const n=(new Date).toISOString().split("T")[0],[r,a]=(0,t.useState)(n);return(0,t.createElement)("input",{type:"date",value:r,onChange:t=>{a(t.target.value);let n=(e=>{const t=new Date(e);t.setDate(t.getDate()-t.getDay()+1);const n=new Date(t);return n.setDate(n.getDate()+6),{startDate:t,endDate:n}})(new Date(t.target.value));e(n),console.log(n)}})};const m=()=>{const[e,n]=(0,t.useState)({hasFixedTimeSlots:!1,slotDuration:0,multipleAppointments:!1,maxAppointments:0,multiplePracticians:!1,multiPrestations:!1,indicateNumberOfParticipants:!1,allowObservations:!1});(0,t.useEffect)((()=>{(async function(e){try{let t=new URL("https://wordpress-react-test.local/wp-json/booker67/v1/options/filter");e.forEach((e=>t.searchParams.append("types[]",e)));const n=await fetch(t);if(!n.ok)throw new Error("Erreur réseau ou serveur");const r=await n.json();return console.log("Options récupérées:",r),r}catch(e){console.error("Erreur lors de la récupération des options:",e)}})(["genType_hasFixedTimeSlots","genType_multipleAppointments","genType_slotDuration","genType_maxAppointments","genType_multiplePracticians","genType_multiPrestations","genType_indicateNumberOfParticipants","genType_allowObservations"]).then((e=>{n(r(e))}))}),[]);const r=t=>{let n={...e};return t.forEach((e=>{const t=e.generic_type.replace("genType_","");n[t]="true"===e.value||"false"===e.value?"true"===e.value:e.value})),n},[a,i]=(0,t.useState)(0),[s,c]=(0,t.useState)(0),[u,m]=(0,t.useState)(null),[g,h]=(0,t.useState)(null),[E,f]=(0,t.useState)([]),[w,b]=(0,t.useState)({startDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+1),t.toISOString().split("T")[0]})(),endDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+7),t.toISOString().split("T")[0]})()});return(0,t.createElement)("div",null,e.multiplePracticians&&(0,t.createElement)(l,{onPractitionerChange:e=>{i(e),fetch(`/wp-json/booker67/v1/human-ressource/${e}`).then((e=>{if(!e.ok)throw new Error("Erreur réseau lors de la récupération des données");return e.json()})).then((e=>{m(e)})).catch((e=>{console.error("Erreur lors de la récupération des données:",e)}))}}),e.multiPrestations&&(0,t.createElement)(o,{practitionerId:a,onPrestationChange:e=>{c(e),fetch(`/wp-json/booker67/v1/prestation/${e}`).then((e=>{if(!e.ok)throw new Error("Erreur réseau lors de la récupération de la prestation");return e.json()})).then((e=>{h(e),console.log("prestation change choisi: ",g)})).catch((e=>{console.error("Erreur lors de la récupération de la prestation:",e)}))}}),(0,t.createElement)(d,{onWeekChange:e=>{b(e)}}),0!==a&&(0,t.createElement)(p,{options:e,practician:u,prestation:g,selectedPractitionerId:a,selectedWeek:w}))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("booking67-root");e&&r().render((0,t.createElement)(m,null),e)}))}();