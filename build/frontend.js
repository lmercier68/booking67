!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.ReactDOM,o=e.n(n),a=window.wp.element,r=function({practitionerId:e,onPrestationChange:n}){const[o,r]=(0,a.useState)([]);return(0,a.useEffect)((()=>{(async()=>{if(0!==e&&void 0!==e){let t="/wp-json/booker67/v1/prestations";e&&(t+=`/practitioner_id/${e}`),console.log('recuperation des prestation pour l"id: ',e);try{const e=await fetch(t),n=await e.json();console.log("prestation recupérée : ",n),r(n)}catch(e){console.error("Erreur lors de la récupération des prestations:",e)}}})()}),[e]),console.log("prestations for practician: ",o),(0,t.createElement)("select",{onChange:e=>{n(e.target.value)}},(0,t.createElement)("option",{value:""},"Sélectionnez une prestation"),o.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.prestation_name," - ",e.prestation_cost," - ",e.prestation_duration))))},l=function({onPractitionerChange:e}){const[n,o]=(0,t.useState)([]);return(0,t.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{o(e)})).catch((e=>{console.error(e)}))}),[]),(0,t.createElement)("div",null,(0,t.createElement)("select",{id:"humanRessourceSelect",onChange:t=>{e(t.target.value)}},(0,t.createElement)("option",{value:""},"Choisir un praticien"),n.map((e=>(0,t.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},i=({dateTimeSlot:e,practician:n,prestation:o,selectedWeek:a,setNewAppointment:r,slot:l,onClose:i})=>{console.log(e);const s={backgroundColor:"#f44336",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"};return(0,t.createElement)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"white",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px",zIndex:1e3}},n?o?(0,t.createElement)("div",null,(0,t.createElement)("h3",null,"Veuillez confirmer votre prise de rendez-vous"),(0,t.createElement)("p",null,(0,t.createElement)("br",null),(0,t.createElement)("b",null,"Praticien :")," ",n.nom," ",n.prenom," - ",(0,t.createElement)("b",null,n.role),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"Prestation :")," ",(0,t.createElement)("b",null,o.prestation_name)," au tarif de ",(0,t.createElement)("b",null,o.prestation_cost)," pour une durée de ",(0,t.createElement)("b",null,o.prestation_duration),(0,t.createElement)("hr",null),(0,t.createElement)("b",null,"date du rendez-vous :"),"  le ",e.day," ",e.date," à ",(0,t.createElement)("b",null,e.time)),(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px"}},(0,t.createElement)("button",{style:{backgroundColor:"#4CAF50",color:"white",padding:"10px 20px",margin:"10px",border:"none",borderRadius:"5px",cursor:"pointer",boxShadow:"0 2px 2px rgba(0, 0, 0, 0.2)"},onClick:()=>{r(!0),i()}},"Valider"),(0,t.createElement)("button",{style:s,onClick:()=>{r(!1),i()}},"Annuler"))):(0,t.createElement)("div",null,"merci de choisir une prestation",(0,t.createElement)("button",{style:s,onClick:()=>{r(!1),i()}},"Annuler")):(0,t.createElement)("div",null,"merci de choisir un praticien",(0,t.createElement)("button",{style:s,onClick:()=>{r(!1),i()}},"Annuler")))},s=function({practician:e,prestation:n,selectedWeek:o,slot:a,setNewAppointment:r,dateTimeSlot:l,setDateTimeSlot:s}){const[c,u]=(0,t.useState)(!1),[p,d]=(0,t.useState)(!1);if(!a)return null;const{time:m,isAvailable:g}=a,f=new Date("1970-01-01T"+m).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1}),h={cursor:"pointer",padding:"5px",backgroundColor:g?c?"orange":"white":"red",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px solid #ccc"};return console.log("selectedWeek: ",o),console.log("dateTimeSlot",l),console.log("practician",e),console.log("prestation",n),(0,t.createElement)("div",{onClick:()=>{g&&!p&&(s(a),d(!0),u(!0),console.log(`Plage horaire de ${m} pour une durée de X minutes cliquée.`))},onBlur:()=>{u(!1)},tabIndex:0,style:h},f,p&&(0,t.createElement)(i,{onClose:e=>{d(!1)},slot:a,setNewAppointment:r,practician:e,prestation:n,selectedWeek:o,dateTimeSlot:l}))},c=({practician:e,prestation:n,selectedWeek:o,slotsByDay:a,daysOfWeek:r,setNewAppointment:l,dateTimeSlot:i,setDateTimeSlot:c,timeOfDay:u})=>{const p=(e=>{const t=new Set;return Object.values(e).forEach((e=>{e.forEach((e=>{t.add(e.time)}))})),Array.from(t).sort()})(a),d=p.filter((e=>{const t=parseInt(e.split(":")[0]);return"AM"===u?t<12:t>=12})),m={width:100/r.length+"%",textAlign:"center",fontWeight:"bold"};return(0,t.createElement)("table",{style:{width:"100%",tableLayout:"fixed"}},(0,t.createElement)("thead",{style:{textAlign:"center",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",borderRadius:"10px",border:"2px"}},(0,t.createElement)("tr",null,r.map((e=>(0,t.createElement)("th",{key:e},e))))),(0,t.createElement)("tbody",null,d.map(((u,p)=>(0,t.createElement)("tr",{key:p},r.map((r=>{const p=a[r]?.find((e=>e.time===u))||{time:u,isAvailable:!1};return(0,t.createElement)("td",{key:r,style:m},(0,t.createElement)(s,{slot:p,setNewAppointment:l,practician:e,prestation:n,selectedWeek:o,dateTimeSlot:i,setDateTimeSlot:c}))})))))))},u=function({onSelectionChange:e}){const[n,o]=(0,t.useState)("AM"),a=t=>{o(t.target.value),console.log(t.target.value),e(t.target.value)};return(0,t.createElement)("div",null,(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"AM",checked:"AM"===n,onChange:a}),"Matin"),(0,t.createElement)("label",null,(0,t.createElement)("input",{type:"radio",value:"PM",checked:"PM"===n,onChange:a}),"Après-midi"))};window.wp["components/buildTypes/utils/values"];var p=({options:e,practician:n,prestation:o,selectedPractitionerId:a,selectedWeek:r})=>{const[l,i]=(0,t.useState)(["e","r"]),[s,p]=(0,t.useState)([]),[d,m]=(0,t.useState)(!1),[g,f]=(0,t.useState)(null),[h,E]=(0,t.useState)("AM");(0,t.useEffect)((()=>{console.log("useEffect0-1"),d&&(async(e,t,n,o,a,r)=>{const l={practician_id:e,prestation_id:t,prestation_duration:n,rdv_dateTime:o,rdv_status:1,customer_id:void 0};try{const e=await fetch("/wp-json/booker67/v1/add-rdv/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),t=await e.json();console.log("Succès:",t)}catch(e){console.error("Erreur:",e)}})(n.id,o.id,o.prestation_duration,function(e,t){const[n,o,a]=e.split("/");return new Date(`${a}-${o}-${n}T${t}`)}(g.date,g.time)),console.log("useEffect0-2")}),[d]),(0,t.useEffect)((()=>{console.log("fetch appointments"),(async()=>{if(console.log("useEffect1-1"),a&&0!==a||!e.multiplePracticians&&1===a){console.log("practionner_id useeffect: ",a);let t=0;t=e.multiplePracticians?a:1,console.log("pract_id",t);try{const e=await fetch(`/wp-json/booker67/v1/appointments/${t}`),n=await e.json();console.log("appoitements: ",n),p(n)}catch(e){console.error("Erreur lors de la récupération des rendez-vous:",e)}}})()}),[a]),(0,t.useEffect)((()=>{console.log("fetch availability"),console.log("fetch avail pratci: ",a),(async()=>{if(a&&0!==a){console.log("useEffect2-1"),console.log("selectedPractitionerId",a);try{const e=await fetch(`/wp-json/booker67/v1/availability/${a}`),t=await e.json();console.log("useEffect2-2 data: ",t);const n=new Date(r.startDate),o=new Date(r.endDate),l=y(n),c=w(t,s,l),u=b(c,n,o,l);i(u),console.log("useEffect2-3 slotForWeek",u)}catch(e){console.error("Erreur lors de la récupération des disponibilités:",e)}}})()}),[a,s,r]);const w=(t,n,o)=>{let a=[],r=new Map;return t.forEach((t=>{let n=t.day_name.charAt(0).toUpperCase()+t.day_name.slice(1),a=o.get(n);if(a){let o=new Date(a);o.setHours(t.opening_time.split(":")[0],t.opening_time.split(":")[1],0);let l=new Date(a);l.setHours(t.closing_time.split(":")[0],t.closing_time.split(":")[1],0);let i=[];for(;o<l;)i.push(new Date(o)),o.setMinutes(o.getMinutes()+parseInt(e.slotDuration));r.set(n,i)}})),n.forEach((e=>{let t=new Date(e.rdv_dateTime),n=parseInt(e.prestation_duration.split(":")[0]),o=parseInt(e.prestation_duration.split(":")[1]||"0"),a=new Date(t);a.setHours(a.getHours()+n),a.setMinutes(a.getMinutes()+o);let l=t.toLocaleDateString("fr-FR",{weekday:"long"});l=l.charAt(0).toUpperCase()+l.slice(1);let i=r.get(l);i&&r.set(l,i.filter((e=>e<t||e>=a)))})),r.forEach(((e,t)=>{e.forEach((e=>{let n=e.toLocaleDateString("fr-FR");a.push({day:t,date:n,time:e.toLocaleTimeString("fr-FR")})}))})),a},y=e=>{let t=new Map;for(;1!==e.getDay();)e.setDate(e.getDate()-1);for(let n=0;n<7;n++){let o=new Date(e);o.setDate(e.getDate()+n);let a=o.toLocaleDateString("fr-FR",{weekday:"long"});a=a.charAt(0).toUpperCase()+a.slice(1),t.set(a,o)}return t},b=(e,t,n,o)=>e.filter((e=>{const a=o.get(e.day);return a&&a>=t&&a<=n})),v=new Date(r.startDate),D=new Date(r.endDate),S=y(v),k=b(l,v,D,S).reduce(((e,t)=>(e[t.day]=e[t.day]||[],e[t.day].push({...t,isAvailable:!0}),e)),{});return(0,t.createElement)("div",null,l.length>0?(0,t.createElement)("div",null," horaires",(0,t.createElement)(u,{onSelectionChange:e=>{E(e)}}),(0,t.createElement)(c,{slotsByDay:k,practician:n,prestation:o,selectedWeek:r,setNewAppointment:m,daysOfWeek:["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],dateTimeSlot:g,setDateTimeSlot:f,timeOfDay:h})):(0,t.createElement)("p",null,"Aucun créneau disponible pour cette semaine."))},d=({onWeekChange:e})=>{const n=(new Date).toISOString().split("T")[0],[o,a]=(0,t.useState)(n);return(0,t.createElement)("input",{type:"date",value:o,onChange:t=>{a(t.target.value);let n=(e=>{const t=new Date(e);t.setDate(t.getDate()-t.getDay()+1);const n=new Date(t);return n.setDate(n.getDate()+6),{startDate:t,endDate:n}})(new Date(t.target.value));e(n),console.log(n)}})};const m=()=>{const[e,n]=(0,t.useState)({hasFixedTimeSlots:!1,slotDuration:0,multipleAppointments:!1,maxAppointments:0,multiplePracticians:!1,multiPrestations:!1,indicateNumberOfParticipants:!1,allowObservations:!1}),[o,a]=(0,t.useState)(0),[i,s]=(0,t.useState)(0),[c,u]=(0,t.useState)(null),[m,g]=(0,t.useState)(null);(0,t.useEffect)((()=>{(async function(e){try{let t=new URL("https://wordpress-react-test.local/wp-json/booker67/v1/options/filter");e.forEach((e=>t.searchParams.append("types[]",e)));const n=await fetch(t);if(!n.ok)throw new Error("Erreur réseau ou serveur");const o=await n.json();return console.log("Options récupérées:",o),o}catch(e){console.error("Erreur lors de la récupération des options:",e)}})(["genType_hasFixedTimeSlots","genType_multipleAppointments","genType_slotDuration","genType_maxAppointments","genType_multiplePracticians","genType_multiPrestations","genType_indicateNumberOfParticipants","genType_allowObservations"]).then((e=>{n(f(e))})),e.multiplePracticians?w(0):w(1),console.log("multipleractician2",e.multiplePracticians)}),[o]);const f=t=>{let n={...e};return t.forEach((e=>{const t=e.generic_type.replace("genType_","");n[t]="true"===e.value||"false"===e.value?"true"===e.value:e.value})),n},[h,E]=(0,t.useState)({startDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+1),t.toISOString().split("T")[0]})(),endDate:(()=>{const e=new Date,t=new Date(e);return t.setDate(t.getDate()-t.getDay()+7),t.toISOString().split("T")[0]})()}),w=async e=>{console.log("handlepractionner change",e);const t=`/wp-json/booker67/v1/human-ressource/${e}`;try{const n=await fetch(t);if(!n.ok)throw new Error("Erreur réseau lors de la récupération des données");const o=await n.json();u(o),a(e),console.log("handlePractionnerChange data : ",o)}catch(e){console.error("Erreur lors de la récupération des données:",e)}};return console.log("multipleractician3",e.multiplePracticians),(0,t.createElement)("div",null,e.multiplePracticians&&(0,t.createElement)(l,{onPractitionerChange:w}),e.multiPrestations&&(0,t.createElement)(r,{practitionerId:o,onPrestationChange:async e=>{console.log("handleprestation change"),s(e);const t=`/wp-json/booker67/v1/prestation/${e}`;try{const e=await fetch(t);if(!e.ok)throw new Error("Erreur réseau lors de la récupération de la prestation");const n=await e.json();g(n),console.log("prestation change choisi: ",n),console.log("handlePrestationChange data : ",n)}catch(e){console.error("Erreur lors de la récupération de la prestation:",e)}}}),(0,t.createElement)(d,{onWeekChange:e=>{E(e)}}),o&&(0,t.createElement)(p,{options:e,practician:c,prestation:m,selectedPractitionerId:o,selectedWeek:h}))};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("booking67-root");e&&o().render((0,t.createElement)(m,null),e)}))}();