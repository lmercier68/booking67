!function(){var e,t={184:function(e,t){var n;!function(){"use strict";var a={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var r=typeof n;if("string"===r||"number"===r)e.push(n);else if(Array.isArray(n)){if(n.length){var l=o.apply(null,n);l&&e.push(l)}}else if("object"===r){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var i in n)a.call(n,i)&&n[i]&&e.push(i)}}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()},251:function(e,t,n){"use strict";var a=n(196),o=Symbol.for("react.element"),r=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),l=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var a,s={},c=null,d=null;for(a in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)r.call(t,a)&&!i.hasOwnProperty(a)&&(s[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===s[a]&&(s[a]=t[a]);return{$$typeof:o,type:e,key:c,ref:d,props:s,_owner:l.current}}},893:function(e,t,n){"use strict";e.exports=n(251)},762:function(e,t,n){"use strict";var a=window.wp.blocks,o=n(196),r=window.wp.element;const l=(0,r.createContext)({selectedValue:"0",setSelectedValue:()=>{},handleHumanRessourceChange:()=>{},handleNewAvail:()=>{}}),i=({children:e})=>{const[t,n]=(0,r.useState)("0"),[a,i]=(0,r.useState)(!1),[s,c]=(0,r.useState)([]);return(0,o.createElement)(l.Provider,{value:{selectedValue:t,setSelectedValue:n,handleHumanRessourceChange:e=>{const t=e.target.value;console.log("handleHumanRessourceChange triggered with selectedValue:",t),n(t),i(!0),console.log("Fetching data with URL:",`/wp-json/booker67/v1/availability?value=${t}`),fetch(`/wp-json/booker67/v1/availability?value=${t}`).then((e=>e.json())).then((e=>{console.log("Received data:",e),c(e)})).finally((()=>{console.log("Loading finished"),i(!1)}))},handleNewAvail:e=>{const t=e;console.log("handleHumanRessourceChange triggered with selectedValue:",t),i(!0),console.log("Fetching data with URL:",`/wp-json/booker67/v1/availability?value=${t}`),fetch(`/wp-json/booker67/v1/availability?value=${t}`).then((e=>e.json())).then((e=>{console.log("Received data:",e),c(e)})).finally((()=>{console.log("Loading finished"),i(!1)}))},loading:a,availabilities:s}},console.log("Rendering SelectionProvider with:",{selectedValue:t,loading:a,availabilities:s}),e)};var s=n(184),c=n.n(s),d=n(893);const u=["as","disabled"];function p({tagName:e,disabled:t,href:n,target:a,rel:o,role:r,onClick:l,tabIndex:i=0,type:s}){e||(e=null!=n||null!=a||null!=o?"a":"button");const c={tagName:e};if("button"===e)return[{type:s||"button",disabled:t},c];const d=a=>{(t||"a"===e&&function(e){return!e||"#"===e.trim()}(n))&&a.preventDefault(),t?a.stopPropagation():null==l||l(a)};return"a"===e&&(n||(n="#"),t&&(n=void 0)),[{role:null!=r?r:"button",disabled:void 0,tabIndex:t?void 0:i,href:n,target:"a"===e?a:void 0,"aria-disabled":t||void 0,rel:"a"===e?o:void 0,onClick:d,onKeyDown:e=>{" "===e.key&&(e.preventDefault(),d(e))}},c]}o.forwardRef(((e,t)=>{let{as:n,disabled:a}=e,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,u);const[r,{tagName:l}]=p(Object.assign({tagName:n,disabled:a},o));return(0,d.jsx)(l,Object.assign({},o,r,{ref:t}))})).displayName="Button";const m=o.createContext({prefixes:{},breakpoints:["xxl","xl","lg","md","sm","xs"],minBreakpoint:"xs"}),{Consumer:f,Provider:v}=m;const h=o.forwardRef((({as:e,bsPrefix:t,variant:n="primary",size:a,active:r=!1,disabled:l=!1,className:i,...s},u)=>{const f=function(e,t){const{prefixes:n}=(0,o.useContext)(m);return e||n[t]||t}(t,"btn"),[v,{tagName:h}]=p({tagName:e,disabled:l,...s}),b=h;return(0,d.jsx)(b,{...v,...s,ref:u,disabled:l,className:c()(i,f,r&&"active",n&&`${f}-${n}`,a&&`${f}-${a}`,s.href&&l&&"disabled")})}));h.displayName="Button";var b=h,g=function({day_name:e="Day",onChange:t,dayStyle:n,availabilities:a=[],setIsModified:i,availabilityId:s}){const{selectedValue:c}=(0,r.useContext)(l),d="0"===c,[u,p]=(0,r.useState)(!1),[m,f]=(0,r.useState)([]),[v,h]=(0,r.useState)(!1),[g,y]=(0,r.useState)(!1),k=()=>{f([...m,{start:"",end:""}])},E=(e,t,n)=>{const a=e.target.value;console.log("handleInputChange-plaanerline:",a,t,n);const o=[...m];o[t][n]=a,f(o)},w=(n,a,o)=>{const r=n.target.value,l=[...m];l[a][o]=r,f(l);const i=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,s=i.test(l[a].start),c=i.test(l[a].end);s&&c&&(console.log("valeur envoyée a onChnge",{value:l[a],index:a,day:e}),t({value:{start:l[a].start,end:l[a].end,id:l[a].id},index:a,day:e})),y(!0)};return(0,r.useEffect)((()=>{if(g){const e=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;for(let t of m)if(!(""===t.start||""===t.end||e.test(t.start)&&e.test(t.end))){v||(alert("Veuillez saisir une heure au format hh:mm"),h(!0));break}y(!1)}}),[g,m,v]),(0,r.useEffect)((()=>{let e;a&&a.length>0?(e=a.map((e=>({start:e.opening_time.slice(0,5),end:e.closing_time.slice(0,5),id:e.id}))),p(!0)):(e=[{start:"",end:"",id:void 0}],p(!1)),f(e)}),[a]),(0,o.createElement)("div",{className:"container"},(0,o.createElement)("div",{className:"row align-items-center"},(0,o.createElement)("div",{className:"col-auto"},(0,o.createElement)("input",{type:"checkbox",className:"form-check-input",checked:u,onChange:()=>p(!u),disabled:d})),(0,o.createElement)("div",{className:"col-auto"},(0,o.createElement)("label",{className:"form-label",style:{...n}},e)),(0,o.createElement)("div",{className:"col"},m.map(((e,t)=>(0,o.createElement)("div",{key:t,className:"d-flex align-items-center"},(0,o.createElement)("label",{className:"form-label"},"De"),(0,o.createElement)("input",{type:"text",className:"form-control",value:e.start,disabled:!u||d,placeholder:"hh:mm",style:{marginTop:0===t?0:"5px"},onChange:e=>E(e,t,"start"),onBlur:e=>w(e,t,"start")}),(0,o.createElement)("label",{className:"form-label"},"  A"),(0,o.createElement)("input",{type:"text",className:"form-control ms-2",value:e.end,disabled:!u||d,placeholder:"hh:mm",style:{marginTop:0===t?0:"5px"},onChange:e=>E(e,t,"end"),onBlur:e=>w(e,t,"end")}),e.start&&e.end&&(0,o.createElement)("button",{className:"btn btn-danger ms-2",onClick:()=>(e=>{const t=m[e].id;t?fetch(`/wp-json/booker67/v1/availability/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce}}).then((e=>e.json())).then((t=>{console.log("Suppression réussie:",t),f((t=>t.filter(((t,n)=>n!==e))))})).catch((e=>{console.error("Erreur:",e)})):console.error("ID non trouvé, impossible de supprimer.")})(t)},"-"),(0,o.createElement)(b,{onClick:k,disabled:!u||d,className:"btn btn-primary ms-2"},"+")))))))},y=function(){const{handleHumanRessourceChange:e}=(0,r.useContext)(l),[t,n]=(0,r.useState)([]);return(0,r.useEffect)((()=>{fetch("/wp-json/booker67/v1/human_ressources_actif").then((e=>e.json())).then((e=>{n(e)}))}),[]),(0,o.createElement)("div",null,(0,o.createElement)("select",{id:"humanRessourceSelect",onChange:e},"  // Utilisez handleHumanRessourceChange comme gestionnaire d'événements",(0,o.createElement)("option",{value:"0"},"Choisir un praticien"),t.map((e=>(0,o.createElement)("option",{key:e.id,value:e.id},e.nom," ",e.prenom," - ",e.role)))))},k=window.wp.components,E=function(){const e=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],{loading:t,availabilities:n,selectedValue:a}=(0,r.useContext)(l),[i,s]=(0,r.useState)(!1),[c,d]=(0,r.useState)({}),u=e.reduce(((e,t)=>t.length>e.length?t:e),""),{handleNewAvail:p}=(0,r.useContext)(l),m={minWidth:`${u.length}ch`,display:"inline-block"};return(0,o.createElement)("div",null,t&&(0,o.createElement)(k.Spinner,null),(0,o.createElement)("div",{style:t?{pointerEvents:"none",opacity:.5}:{}},(0,o.createElement)(y,null),e.map((e=>{const t=n?n.filter((t=>t.day_name===e)):[];return(0,o.createElement)("div",{key:e},"  ",(0,o.createElement)(g,{day_name:e,dayStyle:m,availabilityId:t.id,availabilities:t,onChange:(e,t,n,o)=>(({value:e,index:t,day:n})=>{console.log("handleInputChange-weekly",{value:e,index:t,day:n}),console.log(`On day ${n}, Input at index ${t} has values:`,e),console.log("valueId-weeklyplan: ",e.id),s(!0);const o={day:n,index:t,opening_time:e.start,closing_time:e.end,id:e.id};console.log("valueId: ",e.id);const r={id:e.id,practician_id:a,day_name:n,opening_time:e.start,closing_time:e.end};console.log("postData: ",r);const l=e.id?`/wp-json/booker67/v1/availability/${e.id}`:"/wp-json/booker67/v1/availability",i=e.id?"PUT":"POST";fetch(l,{method:i,headers:{"Content-Type":"application/json","X-WP-Nonce":wpApiSettings.nonce},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{console.log("Response:",e),p(a)})).catch((e=>{console.error("Error:",e)})),d((e=>{const a=e[n]?[...e[n]]:[];return a[t]=o,{...e,[n]:a}}))})(e),setIsModified:s}),(0,o.createElement)("hr",null))}))),(0,o.createElement)("button",{style:{backgroundColor:i?"orange":"mediumblue",color:"white",borderRadius:"5px",padding:"10px",border:"none",cursor:"pointer"},disabled:!i,onClick:()=>{if("object"!=typeof n||!n)return console.log("availabilities",n),void console.error("availabilities is not an object:",n);console.log("availabilities",n);const e=Object.entries(n).map((([e,t])=>Array.isArray(t)?t.map((t=>({practician_id:1,day_name:e,...t}))):(console.error("slots is not an array for day",e,":",t),[]))).flat();fetch("/wp-json/booker67/v1/availability",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject("Failed to save"))).then((e=>{console.log(e.message),s(!1)})).catch((e=>{console.error("Error:",e)}))}},"Save"))},w=JSON.parse('{"u2":"booker67/planner"}');(0,a.registerBlockType)(w.u2,{attributes:{selectedDate:{type:"string",default:""},availableSlots:{type:"array",default:[]}},edit:function({attributes:e,setAttributes:t}){return(0,o.createElement)("div",null,(0,o.createElement)(i,null,(0,o.createElement)(E,null)))},save:function({attributes:e}){return(0,o.createElement)("div",{className:"booker67-datepicker-container"},(0,o.createElement)("input",{type:"text",id:"booker67-datepicker",name:"booker67-datepicker",placeholder:"Sélectionnez une date"}))}})},196:function(e){"use strict";e.exports=window.React}},n={};function a(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=function(t,n,o,r){if(!n){var l=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],r=e[d][2];for(var i=!0,s=0;s<n.length;s++)(!1&r||l>=r)&&Object.keys(a.O).every((function(e){return a.O[e](n[s])}))?n.splice(s--,1):(i=!1,r<l&&(l=r));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,o,r]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={303:0,22:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,l=n[0],i=n[1],s=n[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(s)var d=s(a)}for(t&&t(n);c<l.length;c++)r=l[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self.webpackChunkbooker67=self.webpackChunkbooker67||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var o=a.O(void 0,[22],(function(){return a(762)}));o=a.O(o)}();