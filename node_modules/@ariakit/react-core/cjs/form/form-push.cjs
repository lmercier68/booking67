"use strict";Object.defineProperty(exports, "__esModule", {value: true});"use client";


var _P34T42GIcjs = require('../__chunks/P34T42GI.cjs');


var _XCM6Y3AXcjs = require('../__chunks/XCM6Y3AX.cjs');
require('../__chunks/F7HB6RYG.cjs');


var _HY2NPBHWcjs = require('../__chunks/HY2NPBHW.cjs');
require('../__chunks/JVORNAMD.cjs');
require('../__chunks/7ARL6QHN.cjs');
require('../__chunks/75KXQZJX.cjs');




var _VKYTJKYNcjs = require('../__chunks/VKYTJKYN.cjs');


var _JTVNRMACcjs = require('../__chunks/JTVNRMAC.cjs');
require('../__chunks/LNE2FWJO.cjs');




var _WYXAWBLEcjs = require('../__chunks/WYXAWBLE.cjs');

// src/form/form-push.ts
var _react = require('react');
var _misc = require('@ariakit/core/utils/misc');
function getFirstFieldsByName(items, name) {
  if (!items)
    return [];
  const fields = [];
  for (const item of items) {
    if (item.type !== "field")
      continue;
    if (!item.name.startsWith(name))
      continue;
    const nameWithIndex = item.name.replace(/(\.\d+)\..+$/, "$1");
    const regex = new RegExp(`^${nameWithIndex}`);
    if (!fields.some((i) => regex.test(i.name))) {
      fields.push(item);
    }
  }
  return fields;
}
var useFormPush = _VKYTJKYNcjs.createHook.call(void 0, 
  (_a) => {
    var _b = _a, {
      store,
      value,
      name: nameProp,
      getItem: getItemProp,
      autoFocusOnClick = true
    } = _b, props = _WYXAWBLEcjs.__objRest.call(void 0, _b, [
      "store",
      "value",
      "name",
      "getItem",
      "autoFocusOnClick"
    ]);
    const context = _P34T42GIcjs.useFormContext.call(void 0, );
    store = store || context;
    _misc.invariant.call(void 0, 
      store,
      process.env.NODE_ENV !== "production" && "FormPush must be wrapped in a Form component."
    );
    const name = `${nameProp}`;
    const [shouldFocus, setShouldFocus] = _react.useState.call(void 0, false);
    _react.useEffect.call(void 0, () => {
      var _a2;
      if (!shouldFocus)
        return;
      const items = getFirstFieldsByName(store == null ? void 0 : store.getState().items, name);
      const element = (_a2 = items == null ? void 0 : items[items.length - 1]) == null ? void 0 : _a2.element;
      if (!element)
        return;
      element.focus();
      setShouldFocus(false);
    }, [store, shouldFocus, name]);
    const getItem = _react.useCallback.call(void 0, 
      (item) => {
        const nextItem = _WYXAWBLEcjs.__spreadProps.call(void 0, _WYXAWBLEcjs.__spreadValues.call(void 0, {}, item), { type: "button", name });
        if (getItemProp) {
          return getItemProp(nextItem);
        }
        return nextItem;
      },
      [name, getItemProp]
    );
    const onClickProp = props.onClick;
    const onClick = _JTVNRMACcjs.useEvent.call(void 0, (event) => {
      onClickProp == null ? void 0 : onClickProp(event);
      if (event.defaultPrevented)
        return;
      store == null ? void 0 : store.pushValue(name, value);
      if (!autoFocusOnClick)
        return;
      setShouldFocus(true);
    });
    props = _WYXAWBLEcjs.__spreadProps.call(void 0, _WYXAWBLEcjs.__spreadValues.call(void 0, {}, props), {
      onClick
    });
    props = _XCM6Y3AXcjs.useButton.call(void 0, props);
    props = _HY2NPBHWcjs.useCollectionItem.call(void 0, _WYXAWBLEcjs.__spreadProps.call(void 0, _WYXAWBLEcjs.__spreadValues.call(void 0, { store }, props), { getItem }));
    return props;
  }
);
var FormPush = _VKYTJKYNcjs.createComponent.call(void 0, (props) => {
  const htmlProps = useFormPush(props);
  return _VKYTJKYNcjs.createElement.call(void 0, "button", htmlProps);
});
if (process.env.NODE_ENV !== "production") {
  FormPush.displayName = "FormPush";
}



exports.FormPush = FormPush; exports.useFormPush = useFormPush;
